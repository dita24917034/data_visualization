# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ny0D_QkxJgivCUwN4ZVlfxY9ghdsEQca
"""

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app.py
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
# 
# # Load data
df = pd.read_csv("data academic.csv")
# 
prog_code_mapping = {
    'BCH': 'Biochemistry',
    'BLD': 'Building technology',
    'CEN': 'Computer Engineering',
    'CHE': 'Chemical Engineering',
    'CHM': 'Industrial Chemistry',
    'CIS': 'Computer Science',
    'CVE': 'Civil Engineering',
    'EEE': 'Electrical and Electronics Engineering',
    'ICE': 'Information and Communication Engineering',
    'MAT': 'Mathematics',
    'MCB': 'Microbiology',
    'MCE': 'Mechanical Engineering',
    'MIS': 'Management and Information System',
    'PET': 'Petroleum Engineering',
    'PHYE': 'Industrial Physics-Electronics and IT Applications',
    'PHYG': 'Industrial Physics-Applied Geophysics',
    'PHYR' : 'Industrial Physics-Renewable Energy'
}

df['Prog Short'] = df['Prog Code'].map(prog_code_mapping)
# # Judul Dashboard
st.title("üéì Universitas ABC Academic Dashboard")
# --- Filter Program Studi ---
prog_codes = df['Prog Code'].dropna().unique()
selected_prog = st.selectbox("Pilih Program Studi (Prog Code):", sorted(prog_codes))

# --- Filter Tahun Masuk (multiselect) untuk Bar Chart ---
available_yog = sorted(df['YoG'].dropna().unique())
selected_yogs = st.multiselect("Pilih Tahun Masuk (YoG) untuk Bar Chart:", available_yog, default=available_yog)

# --- Informasi Total Mahasiswa (Card) ---
filtered_card_df = df[(df['Prog Code'] == selected_prog) & (df['YoG'].isin(selected_yogs))]
if 'ID No.' in filtered_card_df.columns:
    total_students = filtered_card_df['ID No.'].nunique()
    st.markdown(f"### üìá Total Mahasiswa: `{total_students}`")
else:
    st.warning("Kolom 'ID No.' tidak ditemukan dalam data.")

# --- Bar Chart: Rata-rata CGPA per Tahun (terfilter YoG & Prog Code) ---
st.subheader("üìä Rata-rata CGPA berdasarkan Tahun Masuk")

if 'YoG' in df.columns and 'CGPA' in df.columns:
    filtered_bar_df = df[(df['Prog Code'] == selected_prog) & (df['YoG'].isin(selected_yogs))]
    
    if not filtered_bar_df.empty:
        avg_gpa = filtered_bar_df.groupby('YoG')['CGPA'].mean()
        
        fig_bar, ax_bar = plt.subplots(figsize=(5, 3))  # Ukuran diperbesar/dikecilkan di sini
        avg_gpa.plot(kind='bar', color='skyblue', ax=ax_bar)
        ax_bar.set_ylabel("Rata-rata CGPA")
        ax_bar.set_xlabel("Tahun Masuk")
        ax_bar.set_title(f"Rata-rata CGPA Mahasiswa ({selected_prog})", fontsize=10)
        st.pyplot(fig_bar)
    else:
        st.info("Tidak ada data untuk kombinasi Program dan Tahun Masuk yang dipilih.")
else:
    st.warning("Kolom 'YoG' atau 'CGPA' tidak ditemukan dalam data.")

# --- Filter tambahan untuk Pie Chart ---
st.subheader("üßë‚Äçüéì Filter Gender Pie Chart")

selected_yog_for_pie = st.selectbox("Pilih Tahun Masuk (YoG) untuk Pie Chart:", available_yog)

# --- Pie Chart: Gender Distribution ---
st.subheader("üßë‚Äçüéì Distribusi Gender Mahasiswa (berdasarkan filter)")

filtered_pie_df = df[(df['Prog Code'] == selected_prog) & (df['YoG'] == selected_yog_for_pie)]

if 'Gender' in filtered_pie_df.columns:
    gender_counts = filtered_pie_df['Gender'].value_counts()
    fig_pie, ax_pie = plt.subplots(figsize=(4, 4))  # Ukuran pie chart lebih kecil
    ax_pie.pie(gender_counts, labels=gender_counts.index, autopct='%1.1f%%', startangle=90,
               colors=['lightcoral', 'lightskyblue'], textprops={'fontsize': 9})
    ax_pie.axis('equal')
    st.pyplot(fig_pie)
else:
    st.warning("Kolom 'Gender' tidak ditemukan dalam data.")
